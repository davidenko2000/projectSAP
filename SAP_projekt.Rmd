---
title: "World Happiness Report"
autor: "David Kerman, Marta Knežević, Vinko Sabolčec, Lorena Lazar"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Opis
Podaci kojima se bavimo u ovom projektu su dobiveni kroz ankete koje provode Gallup i Lloyd’s
Register Foundation. Proučavat ćemo podatke iz 2020. godine koji su sadžani u 9 varijabli te podatke iz 2021. godine koji su sadržani u 11 varijabli. Temeljna varijabla je osjećaj sreće prema Cantrilovoj ljestvici gdje su ispitanici ocjenjivali zadovoljstvo vlastitog života na skali od 0 do 10. Vrijednost varijable je prosjek reprezentativnog uzorka pojedine zemlje. Uz to projekt zadrži varijable kao što su BDP po stanovniku, životni vijek, socijalna podrška, percepcija korupcije, doniranje novca u dobrotvorne svrhe, nejednakost dohotha i slično.

```{r, echo=FALSE}
# Učitavanje podataka iz csv datoteke:
whr2020 = read.table("WHR_2020.csv", sep = ",")
whr2021 = read.table("WHR_2021.csv", sep = ",")
dim(whr2020)
dim(whr2021)
```
Summary podataka:
```{r}
print("2020: ")
summary(whr2020[3:9])
print("2021: ")
summary(whr2021[3:9])
```
<!--promjena imena stupaca-->
```{r}
colnames(whr2020) <- c("Country name", "Regional indicator", "Ladder score", "Logged GDP per capita", "Social support", "Healthy life expectancy", "Freedom to make life choices", "Generosity", "Perceptions of corruption") 

colnames(whr2021) <- c("Country name", "Regional indicator", "Ladder score", "Logged GDP per capita", "Social support", "Healthy life expectancy", "Freedom to make life choices", "Generosity", "Perceptions of corruption", "Income Gini", "Wealth Gini") 
names(whr2020)
names(whr2021)
```
# Deskriptivna statistika nad rezultatima grupiranih zemalja po regijama

Izračunajmo srednje vrijednosti i medijane Ladder score-ova po regijama.
```{r}
library(tidyverse)

whr2021 %>% group_by(`Regional indicator`) %>% summarise(
          Mean.LadderScore = mean(`Ladder score`),
          Mean.GDP = mean(`Logged GDP per capita`),
          Mean.SocialSupport = mean(`Social support`),
          Mean.LifeExp = mean(`Healthy life expectancy`),
          Mean.Freedom = mean(`Freedom to make life choices`),
          Mean.Generosity = mean(Generosity),
          Mean.Corruption = mean(`Perceptions of corruption`)
           #Mean.IncomeGini = mean(`Income Gini`),
           #Mean.WealthGini = mean(`Wealth Gini`)
            ) -> summary.result1
summary.result1


whr2021 %>% group_by(`Regional indicator`) %>% summarise(
          Med.LadderScore = median(`Ladder score`),
          Med.GDP = median(`Logged GDP per capita`),
          Med.SocialSupport = median(`Social support`),
          Med.LifeExp = median(`Healthy life expectancy`),
          Med.Freedom = median(`Freedom to make life choices`),
          Med.Generosity = median(Generosity),
          Med.Corruption = median(`Perceptions of corruption`)
            ) -> summary.result2
summary.result2
```
Promatrajući varijable u 2021. godini vidimo da su vrijednosti podataka u svim varijablama (osim kod varijable za percepciju korupcije") veće za Zapadnu Europu u usporedbi s Centralnom i Istočnom Europom.

Histogram Ladder score-ova:
```{r}
h = hist(whr2021$`Ladder score`,
         main="Ladder score histogram",
         xlab="Ladder score",
         ylab='Frequency',
         col="blue"
         )
```

Možemo li iz dijagrama raspršenja možda naslutiti kakvu vezu između Ladder score i GDP per capita?
Posebno ćemo istaknuti regije na dijagramu.

!ISKORISTITI KOD HIPOTEZA!
```{r}
# Ne razlikujemo vrste regija:
plot(whr2021$`Ladder score`,whr2021$`Logged GDP per capita`,
     col="blue",
     xlab='Ladder score',
     ylab='Logged GDP per capita')

# Razlikujemo vrste regija:
plot(whr2021$`Ladder score`[whr2021$`Regional indicator`=='Central and Eastern Europe'],
     whr2021$`Logged GDP per capita`[whr2021$`Regional indicator`=='Central and Eastern Europe'],
     col='blue',
     xlim=c(min(whr2021$`Ladder score`),max(whr2021$`Ladder score`)),
     ylim=c(min(whr2021$`Logged GDP per capita`),max(whr2021$`Logged GDP per capita`)),
     xlab='Ladder score',
     ylab='Logged GDP per capita')

points(whr2021$`Ladder score`[whr2021$`Regional indicator`=='Western Europe'],
     whr2021$`Logged GDP per capita`[whr2021$`Regional indicator`=='Western Europe'],col='red')
points(whr2021$`Ladder score`[whr2021$`Regional indicator`=='Sub-Saharan Africa'],
     whr2021$`Logged GDP per capita`[whr2021$`Regional indicator`=='Sub-Saharan Africa'],col='green')
```
##Jesu li ljudi u Zapadnoj Europi sretniji od ljudi u Srednjoj i Istočnoj Europi?
```{r}
western_europe = whr2021[whr2021$`Regional indicator` == "Western Europe",]
central_eastern_europe = whr2021[whr2021$`Regional indicator` == "Central and Eastern Europe",]
```

```{r}
cat('Prosječan Ladder score zemalja iz Zapadne Europe ', mean(western_europe$`Ladder score`),'\n')
cat('Prosječan Ladder score zemalja iz Srednje i Istočne Europe', mean(central_eastern_europe$`Ladder score`), '\n')
```
Histogrami za za Zapadnu i Centralnu/Istočnu Europu:
```{r}
h = hist(western_europe$`Ladder score`,
         main="Ladder score Western Europe",
         xlab="Ladder score",
         ylab='Frequency',
         col="blue",
         breaks = 20
         )

h = hist(central_eastern_europe$`Ladder score`,
         main="Ladder score Central and Eastern Europe",
         xlab="Ladder score",
         ylab='Frequency',
         col="blue",
         breaks = 20
         )
```
Pravokutni dijagram za Zapadnu i Centralnu/Istočnu Europu:
```{r}
boxplot(western_europe$`Ladder score`,central_eastern_europe$`Ladder score`,
        main='Ladder score box-plot',
        ylab='Ladder score', xlab="Regional indicator", names = c("Western Europe", "Central and Eastern Europe"))
```
Postoje indikacije da bi ljudi iz zemalja Zapadne Europe trebali biti sretniji od ljudi iz zemalja Srednje i Istočne Europe.

Ovakvo ispitivanje možemo provesti t-testom. Kako bi mogli provesti test, moramo najprije provjeriti pretpostavke normalnosti i nezavisnosti uzorka. Obzirom da razmatramo dva uzoraka iz dvije različite regije, možemo pretpostaviti njihovu nezavisnost. Sljedeći korak je provjeriti normalnost podataka koju ćemo provjeriti qq-plotom i KS testom.
```{r}
qqnorm(western_europe$`Ladder score`, pch = 1, frame = FALSE,main='Western Europe')
qqline(western_europe$`Ladder score`, col = "steelblue", lwd = 2)

qqnorm(central_eastern_europe$`Ladder score`, pch = 1, frame = FALSE,main='Central and Eastern Europe')
qqline(central_eastern_europe$`Ladder score`, col = "steelblue", lwd = 2)
```
Iz ovih rezultata proizlazi da podaci ne dolaze iz normalne distribucije. Trebat ćemo koristiti neku funkciju da bi transformirali podatke te nakon toga provesti test.
```{r}
ks.test(western_europe$`Ladder score`, "pnorm")
ks.test(central_eastern_europe$`Ladder score`, "pnorm")
```

```{r}
library(boot)

bootFunc <- function(data,i){
  d <- data[i,]
  c(
    cor(d[,1],d[,2],method="s"),
    median(d[,1]),
    median(d[,2])
  )
}
  
bw <- boot(western_europe[3:4], bootFunc, R = 100)
bce <- boot(central_eastern_europe[3:4], bootFunc, R = 100)
  
print(bw)
print(bce)
  
boot.ci(bw, index = 1)
boot.ci(bce, index = 1)
```

<!-- Vinko i Marta od tu nadalje -->

# Usporedba razina sreće u 2020. i 2021. godini.

```{r}
library(ggplot2)

data2021 = whr2021[c("Country name", "Ladder score")]
names(data2021)[names(data2021) == "Country name"] = "region"

mapdata2021 = map_data("world")
mapdata2021 = left_join(mapdata2021, data2021, by = "region")

map2021 = ggplot(mapdata2021, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = `Ladder score`), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Ladder score", low = "purple", high = "yellow", na.value = "grey50") + theme(axis.text.x = element_blank(),
                             axis.text.y = element_blank(),
                             axis.ticks = element_blank(),
                             axis.title.y = element_blank(),
                             axis.title.x = element_blank(),
                             rect = element_blank())

map2021

```

Pravokutni dijagram Ladder score-ova za 2020. i 2021. godinu.

```{r, echo = FALSE}
boxplot(whr2020$`Ladder score`, whr2021$`Ladder score`,
        main = 'Ladder score box-plot by year',
        xlab = 'Year', ylab = 'Ladder score', names = c('2020', '2021'))
```

Provest ćemo test o jednakosti aritmetičkih sredina za različite godine.
Hipoteze su: \
H~0~: aritmetičke sredine su jednake \
H~1~: aritemetičke sredine nisu jednake



Prije provedbe t-testa provjeravamo pretpostavke normalnosti uzorka. S obzirom na to da razmatramo dva uzoraka iz dvije različite regije, možemo pretpostaviti njihovu nezavisnost. Normalnost podataka provjeravamo qq-plotom.
```{r}
qqnorm(whr2020$`Ladder score`, pch = 1, frame = FALSE,main='Ladder score for 2020')
qqline(whr2020$`Ladder score`, col = "steelblue", lwd = 2)

qqnorm(whr2021$`Ladder score`, pch = 1, frame = FALSE,main='Ladder score for 2021')
qqline(whr2021$`Ladder score`, col = "steelblue", lwd = 2)
```
QQ-plot sugerira na normalnost. 

```{r}
t.test(whr2020$`Ladder score`, whr2021$`Ladder score`, alternative = "two.sided", var.equal = TRUE)

```
Na temelju rezultata možemo zaključiti da su aritmetičke sredine razine sreće za dvije godine jednake.

```{r, echo = FALSE}
c1 = rgb(173,216,230,max = 255, alpha = 80, names = "lt.blue")
c2 = rgb(255,192,203, max = 255, alpha = 80, names = "lt.pink")
ladder2020 = whr2020$`Ladder score`
ladder2021 = whr2021$`Ladder score`
hist1 = hist(ladder2020, breaks = 10, plot = FALSE)
hist2 = hist(ladder2021, breaks = 10, plot = FALSE)
plot(hist1, col = c1, main = "Histogram of ladder score for two years", xlab = "Ladder score")
plot(hist2, col = c2, add = TRUE)
legend("topright",
  legend=c('2020','2021'),
  fill = c(c1,c2)
)
```
Spojimo podatke iz dvije godine:
```{r}
mergedData = merge(whr2020, whr2021, by="Country name", suffixes = c(".20",".21"))

hist(mergedData$`Ladder score.20`,
     main=paste('Histogram of ladder score in 2020'),
     xlab='Ladder score')

hist(mergedData$`Ladder score.21`,
     main=paste('Histogram of ladder score in 2021'),
     xlab='Ladder score')

hist(mergedData$`Ladder score.20`-mergedData$`Ladder score.21`,
     main=paste('Difference in ladder scores between two years'),
     xlab='Ladder score')

qqnorm(mergedData$`Ladder score.20`-mergedData$`Ladder score.21`, 
       pch = 1, 
       frame = FALSE, 
       main=paste('QQ-plot for differences between ladder scores'))
qqline(mergedData$`Ladder score.20`-mergedData$`Ladder score.21`, 
       col = "steelblue", lwd = 2)
```


Histogram razlika nam sugerira normalnost podataka, dok iz qq-plota vidimo malo odstupanje lijevog repa. 
Pod pretpostavkom da su podatci normalni, koristimo upareni t-test.

```{r}
t.test(mergedData$`Ladder score.20`, 
       mergedData$`Ladder score.21`, 
       paired = TRUE, 
       alt = "less")
```

Jako mala p-vrijednost nam ukazuje da postoji statistički značajna razlika u "ladder score-u" u dvije godine. Postoje značajne razlike u sreći pojedinih država.



# Ovisnost razine sreće o drugim varijablama u 2021. godini

## GDP per capita

Možemo li iz dijagrama raspšrenja naslutiti vezu između GDP per capita i Ladder score-a?

```{r, echo = FALSE}
plot(whr2021$`Logged GDP per capita`, whr2021$`Ladder score`,
     col="blue",
     xlab='Logged GDP per capita',
     ylab='2021 Ladder score')
```

Izračunavamo koeficijente linearne regresije.

```{r}
linreg = lm(formula = whr2021$`Ladder score` ~ whr2021$`Logged GDP per capita`)
summary(linreg)

plot(whr2021$`Logged GDP per capita`, whr2021$`Ladder score`,
     col="blue",
     xlab='Logged GDP per capita',
     ylab='2021 Ladder score')
abline(linreg$coefficients[1], linreg$coefficients[2], col = "orange", lwd = 2)

```
Testiramo nezavisnost dvije varijable korištenjem t-testa: \
H~0~: $\beta$~1~ = 0 \
H~1~: $\beta$~1~ $\neq$ 0
<!-- dodati naknadno-->

